# Shopify Theme Structure Documentation

This document explains the architecture and organization of the TOrqued Shopify theme, including key directories, workflow, customization options, and best practices.

## Table of Contents
- [Overview](#overview)
- [Directory Structure](#directory-structure)
- [Theme Architecture](#theme-architecture)
- [Key Files and Their Purposes](#key-files-and-their-purposes)
- [Development Workflow](#development-workflow)
- [Customization Guide](#customization-guide)
- [Liquid Best Practices](#liquid-best-practices)
- [Asset Management](#asset-management)
- [Deployment](#deployment)
- [Troubleshooting](#troubleshooting)

## Overview

TOrqued is a hybrid Shopify theme that combines:
- **Traditional Shopify Liquid** templates for structure and layout
- **React-based dashboard** for interactive features and analytics
- **Modern build tools** (Vite, TypeScript) for asset compilation
- **API integrations** for affiliate tracking and real-time data

This architecture provides the flexibility of Shopify's theme system with the power of modern JavaScript frameworks.

## Directory Structure

```
TOrqued/
├── assets/                    # Compiled static assets (CSS, JS, images)
│   └── (Generated by build process)
├── config/                    # Theme configuration
│   ├── settings_data.json    # Theme settings values
│   └── settings_schema.json  # Theme settings definitions
├── layout/                    # Theme layouts
│   └── theme.liquid          # Main layout template
├── locales/                   # Internationalization (i18n)
│   └── en.default.json       # English translations
├── sections/                  # Reusable theme sections
│   ├── main-cart.liquid      # Shopping cart section
│   ├── main-collection.liquid # Collection page section
│   ├── main-page.liquid      # Generic page section
│   ├── main-product.liquid   # Product page section
│   └── torqued-interface.liquid # Dashboard interface section
├── snippets/                  # Reusable code snippets
│   └── meta-tags.liquid      # SEO meta tags
├── templates/                 # Page templates
│   ├── cart.json             # Cart page template
│   ├── collection.json       # Collection page template
│   ├── index.liquid          # Homepage template
│   ├── page.dashboard.json   # Dashboard page template
│   ├── page.liquid           # Generic page template
│   └── product.json          # Product page template
├── src/                       # Source code (React app)
│   └── client/
│       ├── components/       # React components
│       ├── hooks/            # Custom React hooks
│       ├── utils/            # Utility functions
│       └── main.tsx          # Application entry point
├── scripts/                   # Build and deployment scripts
│   ├── build-shopify.mjs     # Build for Shopify
│   ├── upload-to-shopify.mjs # Upload assets to theme
│   ├── create-section.mjs    # Generate Liquid sections
│   └── validate-theme.mjs    # Validate theme structure
└── index.html                 # Development HTML template
```

## Theme Architecture

### Two-Layer Architecture

#### Layer 1: Shopify Liquid Theme
- Provides the base theme structure
- Handles page routing and templates
- Manages Shopify-specific features (cart, checkout, etc.)
- Renders SEO-friendly HTML

#### Layer 2: React Dashboard
- Embedded in specific sections/pages
- Provides interactive UI components
- Handles real-time data updates
- Communicates with APIs

### Data Flow

```
Shopify Store
    ↓
Liquid Templates (Server-side rendering)
    ↓
HTML with embedded React mount points
    ↓
React Application (Client-side interactivity)
    ↓
API Calls (Shopify, LeadDyno, Custom APIs)
    ↓
Data Display & User Interactions
```

## Key Files and Their Purposes

### Configuration Files

#### `config/settings_schema.json`
Defines theme settings available in the Shopify theme customizer.

**Structure:**
```json
[
  {
    "name": "theme_info",
    "theme_name": "TOrqued Automation Bundle",
    "theme_version": "3.0.0",
    "theme_author": "TOrqued Team"
  },
  {
    "name": "Torqued Configuration",
    "settings": [
      {
        "type": "text",
        "id": "leaddyno_public_key",
        "label": "LeadDyno Public Key",
        "info": "Your LeadDyno API public key for affiliate tracking"
      }
    ]
  }
]
```

#### `config/settings_data.json`
Stores actual theme setting values. Generated by Shopify, not edited directly.

### Layout Files

#### `layout/theme.liquid`
The main layout template that wraps all pages.

**Key Features:**
- Includes `<head>` with meta tags and stylesheets
- Defines header and footer (if present)
- Contains `{{ content_for_layout }}` where page content is inserted
- Loads theme assets and scripts
- Includes analytics and tracking codes

**Example Structure:**
```liquid
<!DOCTYPE html>
<html lang="{{ request.locale.iso_code }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ page_title }}</title>
  {{ content_for_header }}
  {% render 'meta-tags' %}
</head>
<body>
  {{ content_for_layout }}
</body>
</html>
```

### Section Files

Sections are reusable, customizable blocks that can be added to pages through the theme editor.

#### `sections/torqued-interface.liquid`
The main dashboard section that loads the React application.

**Key Components:**
1. **Settings Schema**: Defines customization options
2. **HTML Structure**: Provides mount point for React
3. **Asset Loading**: Loads compiled JavaScript and CSS
4. **Configuration Injection**: Passes settings to React app

**Example:**
```liquid
{% comment %}
  Torqued Dashboard Interface Section
  Loads the React-based dashboard application
{% endcomment %}

<div id="torqued-root" data-config='{{ section.settings | json }}'></div>

{{ 'torqued-dashboard.css' | asset_url | stylesheet_tag }}
{{ 'torqued-dashboard.js' | asset_url | script_tag }}

{% schema %}
{
  "name": "Torqued Dashboard",
  "settings": [
    {
      "type": "text",
      "id": "leaddyno_key",
      "label": "LeadDyno API Key"
    }
  ]
}
{% endschema %}
```

#### Other Section Files
- `main-cart.liquid`: Shopping cart display
- `main-collection.liquid`: Product collection listing
- `main-page.liquid`: Generic page content
- `main-product.liquid`: Product detail page

### Template Files

Templates define the structure of specific page types.

#### JSON Templates
Modern Shopify templates using JSON format allow section-based page building.

**Example `page.dashboard.json`:**
```json
{
  "sections": {
    "main": {
      "type": "torqued-interface",
      "settings": {}
    }
  },
  "order": ["main"]
}
```

#### Liquid Templates
Traditional templates with full Liquid markup.

**Example `page.liquid`:**
```liquid
{% comment %}
  Generic page template
  Renders in sections/main-page.liquid
{% endcomment %}

{% section 'main-page' %}
```

### Snippet Files

Snippets are small, reusable pieces of code included in other templates.

#### `snippets/meta-tags.liquid`
Generates SEO meta tags for search engines and social media.

**Features:**
- Open Graph tags for social sharing
- Twitter Card metadata
- Schema.org structured data
- Canonical URLs

## Development Workflow

### Local Development

1. **Start development server:**
   ```bash
   npm run dev
   ```
   This runs Vite dev server at `http://localhost:5173/`

2. **Make changes:**
   - Edit React components in `src/client/`
   - Edit Liquid templates in `sections/`, `templates/`, etc.
   - Changes to React code hot-reload automatically

3. **Test locally:**
   - Test React components in the browser
   - Verify Liquid template syntax

### Building for Production

1. **Build the React app:**
   ```bash
   npm run build
   ```
   Output: `dist/` directory with compiled assets

2. **Build and rename for Shopify:**
   ```bash
   npm run shopify:deploy
   ```
   This runs three scripts:
   - `build-shopify.mjs`: Builds and renames files
   - `upload-to-shopify.mjs`: Uploads to Shopify theme
   - `create-section.mjs`: Updates Liquid section

### Validation

Before deployment, validate theme structure:
```bash
npm run shopify:validate
```

This checks:
- Required directories exist
- Required files are present
- JSON files are valid
- Theme configuration is correct

## Customization Guide

### Adding a New Section

1. **Create the section file:**
   ```bash
   touch sections/my-section.liquid
   ```

2. **Add Liquid markup and schema:**
   ```liquid
   <div class="my-section">
     <h2>{{ section.settings.title }}</h2>
     <p>{{ section.settings.content }}</p>
   </div>
   
   {% schema %}
   {
     "name": "My Custom Section",
     "settings": [
       {
         "type": "text",
         "id": "title",
         "label": "Section Title",
         "default": "Welcome"
       },
       {
         "type": "textarea",
         "id": "content",
         "label": "Content"
       }
     ],
     "presets": [
       {
         "name": "My Custom Section"
       }
     ]
   }
   {% endschema %}
   ```

3. **Use in a template:**
   ```liquid
   {% section 'my-section' %}
   ```

### Modifying Theme Settings

1. **Edit `config/settings_schema.json`**
2. **Add new settings:**
   ```json
   {
     "name": "Advanced Settings",
     "settings": [
       {
         "type": "checkbox",
         "id": "enable_feature",
         "label": "Enable Custom Feature",
         "default": false
       }
     ]
   }
   ```

3. **Access in templates:**
   ```liquid
   {% if settings.enable_feature %}
     <!-- Feature code -->
   {% endif %}
   ```

### Customizing the React Dashboard

1. **Edit React components** in `src/client/components/`
2. **Add new features** following React best practices
3. **Update TypeScript types** in `src/client/types/`
4. **Test locally** with `npm run dev`
5. **Build and deploy** with `npm run shopify:deploy`

### Adding Custom Styles

1. **For Liquid templates:**
   - Add CSS to a file in `assets/`
   - Include with: `{{ 'custom-styles.css' | asset_url | stylesheet_tag }}`

2. **For React components:**
   - Add styles in component files or `src/client/styles/`
   - Styles are bundled automatically during build

### Internationalization (i18n)

1. **Add translations to `locales/en.default.json`:**
   ```json
   {
     "general": {
       "welcome": "Welcome",
       "loading": "Loading..."
     }
   }
   ```

2. **Use in Liquid templates:**
   ```liquid
   {{ 'general.welcome' | t }}
   ```

3. **Add additional language files:**
   - `locales/fr.json` for French
   - `locales/es.json` for Spanish
   - etc.

## Liquid Best Practices

### Security

**Always use the `json` filter when passing data to JavaScript:**
```liquid
<!-- ✅ CORRECT - Safe from XSS -->
<script>
  const config = {{ section.settings | json }};
</script>

<!-- ❌ WRONG - Vulnerable to XSS -->
<script>
  const config = {{ section.settings }};
</script>
```

### Performance

**Minimize liquid logic in loops:**
```liquid
<!-- ✅ BETTER - Calculate once -->
{% assign discount_rate = 0.2 %}
{% for product in collection.products %}
  {% assign sale_price = product.price | times: discount_rate %}
{% endfor %}

<!-- ❌ SLOWER - Calculation in every iteration -->
{% for product in collection.products %}
  {% assign sale_price = product.price | times: 0.2 %}
{% endfor %}
```

### Readability

**Use comments for complex sections:**
```liquid
{% comment %}
  This section handles the product grid display
  with filtering and pagination support
{% endcomment %}
```

**Reference section locations:**
```liquid
{% comment %}
  Theme: TOrqued v3
  Template: templates/index.liquid
  Section: sections/hero-banner.liquid
{% endcomment %}
```

### Validation

**Check for variable existence:**
```liquid
{% if product %}
  {{ product.title }}
{% else %}
  <p>Product not found</p>
{% endif %}
```

**Use default values:**
```liquid
{{ section.settings.title | default: "Default Title" }}
```

## Asset Management

### Compiled Assets

React app assets are built into:
- `assets/torqued-dashboard.js` - JavaScript bundle
- `assets/torqued-dashboard.css` - Stylesheet bundle

### Static Assets

Place static files in `assets/`:
- Images: `logo.png`, `hero-image.jpg`
- Fonts: `custom-font.woff2`
- Custom scripts: `custom-script.js`

### Asset URLs

**In Liquid templates:**
```liquid
{{ 'filename.js' | asset_url | script_tag }}
{{ 'filename.css' | asset_url | stylesheet_tag }}
<img src="{{ 'image.jpg' | asset_url }}" alt="Description">
```

### Asset Optimization

- **Images**: Compress before uploading
- **JavaScript**: Minified during build process
- **CSS**: Minified and optimized during build
- **Fonts**: Use modern formats (WOFF2)

## Deployment

### Manual Deployment

```bash
# Full deployment process
npm run shopify:deploy
```

This executes:
1. `build-shopify.mjs` - Builds and renames assets
2. `upload-to-shopify.mjs` - Uploads to Shopify
3. `create-section.mjs` - Updates Liquid section

### CI/CD Deployment

GitHub Actions automatically deploys on push to `main`:
- Runs tests and linting
- Builds the application
- Deploys to Shopify theme
- Performs health checks

See `.github/workflows/ci.yml` for full pipeline.

### Deployment Checklist

Before deploying:
- [ ] Run `npm run lint` - No linting errors
- [ ] Run `npm test` - All tests pass
- [ ] Run `npm run build` - Build succeeds
- [ ] Run `npm run shopify:validate` - Theme validation passes
- [ ] Test locally with `npm run dev`
- [ ] Review changes in a development theme first
- [ ] Backup current theme (download from Shopify)

### Environment-Specific Deployment

**Development Theme:**
```bash
SHOPIFY_THEME_ID=dev_theme_id npm run shopify:deploy
```

**Staging Theme:**
```bash
SHOPIFY_THEME_ID=staging_theme_id npm run shopify:deploy
```

**Production Theme:**
```bash
npm run shopify:deploy  # Uses .env SHOPIFY_THEME_ID
```

## Troubleshooting

### Common Issues

#### Issue: Section not appearing in theme editor

**Solutions:**
1. Check that section file is in `sections/` directory
2. Verify `{% schema %}` block is present and valid JSON
3. Add `"presets"` to schema to make it addable
4. Clear theme cache in Shopify admin

#### Issue: React app not loading

**Solutions:**
1. Check browser console for errors
2. Verify `torqued-dashboard.js` and `.css` are uploaded
3. Check that `<div id="torqued-root">` exists in section
4. Ensure assets are loaded with correct tags
5. Try hard refresh (Ctrl+Shift+R)

#### Issue: Liquid syntax errors

**Solutions:**
1. Validate Liquid syntax at [Shopify Liquid Syntax](https://shopify.dev/docs/themes/liquid/reference)
2. Check for unclosed tags (`{% if %}` without `{% endif %}`)
3. Review Shopify theme check output
4. Use online Liquid validators

#### Issue: Build fails

**Solutions:**
1. Clear node_modules and reinstall: `rm -rf node_modules && npm install`
2. Clear build cache: `rm -rf dist/`
3. Check Node.js version: `node --version` (should be 18+)
4. Review error messages for specific issues
5. Check TypeScript compilation: `npx tsc --noEmit`

#### Issue: Upload to Shopify fails

**Solutions:**
1. Verify environment variables in `.env`
2. Check Shopify API credentials are valid
3. Ensure theme ID exists and is accessible
4. Verify API permissions include "Theme" scope
5. Check network connectivity

### Debug Mode

Enable detailed logging:
```bash
DEBUG=* npm run shopify:deploy
```

### Getting Help

If issues persist:
1. Check [Shopify Theme Documentation](https://shopify.dev/docs/themes)
2. Review [GitHub Issues](https://github.com/PublicPNWEK/TOrqued/issues)
3. Open a new issue with:
   - Description of the problem
   - Steps to reproduce
   - Error messages or logs
   - Environment details (OS, Node version, etc.)

## Additional Resources

### Official Documentation
- [Shopify Theme Development](https://shopify.dev/docs/themes)
- [Liquid Reference](https://shopify.dev/docs/themes/liquid/reference)
- [Theme Architecture](https://shopify.dev/docs/themes/architecture)
- [Shopify CLI](https://shopify.dev/docs/themes/tools/cli)

### TOrqued Documentation
- [README.md](../README.md) - Getting started guide
- [CONTRIBUTING.md](../CONTRIBUTING.md) - Contribution guidelines
- [THEME_IMPORT.md](../THEME_IMPORT.md) - Theme import guide
- [COMPETITIVE_ADVANTAGES.md](../COMPETITIVE_ADVANTAGES.md) - Advanced features

### Tools
- [Shopify Theme Kit](https://shopify.github.io/themekit/)
- [Shopify CLI](https://shopify.dev/docs/themes/tools/cli)
- [Liquid Syntax Highlighter](https://marketplace.visualstudio.com/items?itemName=Shopify.theme-check-vscode) (VS Code)

---

**Need Help?** If you have questions about the theme structure or customization, please open an issue or refer to the [Contributing Guide](../CONTRIBUTING.md) for assistance.
