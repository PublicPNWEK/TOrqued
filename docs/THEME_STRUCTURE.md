# Shopify Theme Structure Documentation

This document explains the architecture and organization of the TOrqued Shopify theme, including key directories, workflow, customization options, and best practices.

## Table of Contents
- [Overview](#overview)
- [Directory Structure](#directory-structure)
- [Theme Architecture](#theme-architecture)
- [Key Files and Their Purposes](#key-files-and-their-purposes)
- [Development Workflow](#development-workflow)
- [Customization Guide](#customization-guide)
- [Liquid Best Practices](#liquid-best-practices)
- [Asset Management](#asset-management)
- [Deployment](#deployment)
- [Troubleshooting](#troubleshooting)

## Overview

TOrqued is a hybrid Shopify theme that combines:
- **Traditional Shopify Liquid** templates for structure and layout
- **React-based dashboard** for interactive features and analytics
- **Modern build tools** (Vite, TypeScript) for asset compilation
- **API integrations** for affiliate tracking and real-time data

This architecture provides the flexibility of Shopify's theme system with the power of modern JavaScript frameworks.

## Directory Structure

```
TOrqued/
‚îú‚îÄ‚îÄ assets/                    # Compiled static assets (CSS, JS, images)
‚îÇ   ‚îî‚îÄ‚îÄ (Generated by build process - not tracked in Git)
‚îú‚îÄ‚îÄ config/                    # Theme configuration
‚îÇ   ‚îú‚îÄ‚îÄ settings_data.json    # Theme settings values
‚îÇ   ‚îî‚îÄ‚îÄ settings_schema.json  # Theme settings definitions
‚îú‚îÄ‚îÄ layout/                    # Theme layouts
‚îÇ   ‚îî‚îÄ‚îÄ theme.liquid          # Main layout template
‚îú‚îÄ‚îÄ locales/                   # Internationalization (i18n)
‚îÇ   ‚îî‚îÄ‚îÄ en.default.json       # English translations
‚îú‚îÄ‚îÄ sections/                  # Reusable theme sections
‚îÇ   ‚îú‚îÄ‚îÄ main-cart.liquid      # Shopping cart section
‚îÇ   ‚îú‚îÄ‚îÄ main-collection.liquid # Collection page section
‚îÇ   ‚îú‚îÄ‚îÄ main-page.liquid      # Generic page section
‚îÇ   ‚îú‚îÄ‚îÄ main-product.liquid   # Product page section
‚îÇ   ‚îî‚îÄ‚îÄ torqued-interface.liquid # Dashboard interface section
‚îú‚îÄ‚îÄ snippets/                  # Reusable code snippets
‚îÇ   ‚îî‚îÄ‚îÄ meta-tags.liquid      # SEO meta tags
‚îú‚îÄ‚îÄ templates/                 # Page templates
‚îÇ   ‚îú‚îÄ‚îÄ cart.json             # Cart page template
‚îÇ   ‚îú‚îÄ‚îÄ collection.json       # Collection page template
‚îÇ   ‚îú‚îÄ‚îÄ index.liquid          # Homepage template
‚îÇ   ‚îú‚îÄ‚îÄ page.dashboard.json   # Dashboard page template
‚îÇ   ‚îú‚îÄ‚îÄ page.liquid           # Generic page template
‚îÇ   ‚îî‚îÄ‚îÄ product.json          # Product page template
‚îú‚îÄ‚îÄ src/                       # Source code (React app & server)
‚îÇ   ‚îú‚îÄ‚îÄ client/               # React dashboard application
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/       # React components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ComparisonMode.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OnboardingTour.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Skeleton.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VirtualizedTable.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/            # Custom React hooks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx           # Main app component
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tsx          # Application entry point
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ queryClient.tsx   # React Query configuration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ store.ts          # Zustand state management
‚îÇ   ‚îî‚îÄ‚îÄ server/               # Backend server modules
‚îÇ       ‚îú‚îÄ‚îÄ ai/               # AI-powered features
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ personalization.js # OpenAI product recommendations
‚îÇ       ‚îú‚îÄ‚îÄ auth/             # Authentication
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ oauth2.js     # OAuth2 integration
‚îÇ       ‚îú‚îÄ‚îÄ middleware/       # Express middleware
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ rbac.js       # Role-based access control
‚îÇ       ‚îú‚îÄ‚îÄ websockets/       # Real-time communication
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ wsServer.js   # WebSocket server
‚îÇ       ‚îú‚îÄ‚îÄ secrets.js        # Secret management interface
‚îÇ       ‚îú‚îÄ‚îÄ secrets_aws.js    # AWS Secrets Manager integration
‚îÇ       ‚îú‚îÄ‚îÄ secrets_gcp.js    # GCP Secret Manager integration
‚îÇ       ‚îî‚îÄ‚îÄ tokenManager.js   # OAuth token management
‚îú‚îÄ‚îÄ scripts/                   # Build and deployment scripts
‚îÇ   ‚îú‚îÄ‚îÄ ai-optimize.mjs       # AI-powered bundle optimization
‚îÇ   ‚îú‚îÄ‚îÄ build-shopify.mjs     # Build for Shopify deployment
‚îÇ   ‚îú‚îÄ‚îÄ create-section.mjs    # Generate Liquid sections
‚îÇ   ‚îú‚îÄ‚îÄ deploy-edge.mjs       # Deploy to Cloudflare Workers
‚îÇ   ‚îú‚îÄ‚îÄ migrate-secrets.js    # Migrate secrets to cloud providers
‚îÇ   ‚îú‚îÄ‚îÄ optimize-bundle.mjs   # Bundle size optimization
‚îÇ   ‚îú‚îÄ‚îÄ sync-branches.sh      # Branch synchronization script
‚îÇ   ‚îú‚îÄ‚îÄ upload-to-shopify.mjs # Upload assets to theme
‚îÇ   ‚îî‚îÄ‚îÄ validate-theme.mjs    # Validate theme structure
‚îú‚îÄ‚îÄ dist/                      # Build output (generated)
‚îÇ   ‚îú‚îÄ‚îÄ assets/               # Compiled JS/CSS files
‚îÇ   ‚îî‚îÄ‚îÄ index.html            # Development HTML
‚îú‚îÄ‚îÄ index.html                 # Vite development template
‚îú‚îÄ‚îÄ vite.config.ts            # Vite build configuration
‚îú‚îÄ‚îÄ tsconfig.json             # TypeScript configuration
‚îú‚îÄ‚îÄ package.json              # Dependencies and scripts
‚îú‚îÄ‚îÄ .shopifyignore            # Files to exclude from theme upload
‚îî‚îÄ‚îÄ .env.example              # Environment variable template
```

## Theme Architecture

### Two-Layer Architecture

#### Layer 1: Shopify Liquid Theme
- Provides the base theme structure
- Handles page routing and templates
- Manages Shopify-specific features (cart, checkout, etc.)
- Renders SEO-friendly HTML

#### Layer 2: React Dashboard
- Embedded in specific sections/pages
- Provides interactive UI components
- Handles real-time data updates
- Communicates with APIs

### Data Flow

```
Shopify Store
    ‚Üì
Liquid Templates (Server-side rendering)
    ‚Üì
HTML with embedded React mount points
    ‚Üì
React Application (Client-side interactivity)
    ‚Üì
API Calls (Shopify, LeadDyno, Custom APIs)
    ‚Üì
Data Display & User Interactions
```

## Key Files and Their Purposes

### Configuration Files

#### `config/settings_schema.json`
Defines theme settings available in the Shopify theme customizer.

**Structure:**
```json
[
  {
    "name": "theme_info",
    "theme_name": "TOrqued Automation Bundle",
    "theme_version": "3.0.0",
    "theme_author": "TOrqued Team"
  },
  {
    "name": "Torqued Configuration",
    "settings": [
      {
        "type": "text",
        "id": "leaddyno_public_key",
        "label": "LeadDyno Public Key",
        "info": "Your LeadDyno API public key for affiliate tracking"
      }
    ]
  }
]
```

#### `config/settings_data.json`
Stores actual theme setting values. Generated by Shopify, not edited directly.

### Layout Files

#### `layout/theme.liquid`
The main layout template that wraps all pages.

**Key Features:**
- Includes `<head>` with meta tags and stylesheets
- Defines header and footer (if present)
- Contains `{{ content_for_layout }}` where page content is inserted
- Loads theme assets and scripts
- Includes analytics and tracking codes

**Example Structure:**
```liquid
<!DOCTYPE html>
<html lang="{{ request.locale.iso_code }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ page_title }}</title>
  {{ content_for_header }}
  {% render 'meta-tags' %}
</head>
<body>
  {{ content_for_layout }}
</body>
</html>
```

### Section Files

Sections are reusable, customizable blocks that can be added to pages through the theme editor.

#### `sections/torqued-interface.liquid`
The main dashboard section that loads the React application.

**Key Components:**
1. **Settings Schema**: Defines customization options
2. **HTML Structure**: Provides mount point for React
3. **Asset Loading**: Loads compiled JavaScript and CSS
4. **Configuration Injection**: Passes settings to React app

**Example:**
```liquid
{% comment %}
  Torqued Dashboard Interface Section
  Loads the React-based dashboard application
{% endcomment %}

<div id="torqued-root" data-config='{{ section.settings | json }}'></div>

{{ 'torqued-dashboard.css' | asset_url | stylesheet_tag }}
{{ 'torqued-dashboard.js' | asset_url | script_tag }}

{% schema %}
{
  "name": "Torqued Dashboard",
  "settings": [
    {
      "type": "text",
      "id": "leaddyno_key",
      "label": "LeadDyno API Key"
    }
  ]
}
{% endschema %}
```

#### Other Section Files
- `main-cart.liquid`: Shopping cart display
- `main-collection.liquid`: Product collection listing
- `main-page.liquid`: Generic page content
- `main-product.liquid`: Product detail page

### Template Files

Templates define the structure of specific page types.

#### JSON Templates
Modern Shopify templates using JSON format allow section-based page building.

**Example `page.dashboard.json`:**
```json
{
  "sections": {
    "main": {
      "type": "torqued-interface",
      "settings": {}
    }
  },
  "order": ["main"]
}
```

#### Liquid Templates
Traditional templates with full Liquid markup.

**Example `page.liquid`:**
```liquid
{% comment %}
  Generic page template
  Renders in sections/main-page.liquid
{% endcomment %}

{% section 'main-page' %}
```

### Snippet Files

Snippets are small, reusable pieces of code included in other templates.

#### `snippets/meta-tags.liquid`
Generates SEO meta tags for search engines and social media.

**Features:**
- Open Graph tags for social sharing
- Twitter Card metadata
- Schema.org structured data
- Canonical URLs

## Development Workflow

### Local Development

1. **Start development server:**
   ```bash
   npm run dev
   ```
   This runs Vite dev server at `http://localhost:5173/`

2. **Make changes:**
   - Edit React components in `src/client/`
   - Edit Liquid templates in `sections/`, `templates/`, etc.
   - Changes to React code hot-reload automatically

3. **Test locally:**
   - Test React components in the browser
   - Verify Liquid template syntax

### Building for Production

1. **Build the React app:**
   ```bash
   npm run build
   ```
   Output: `dist/` directory with compiled assets

2. **Build and rename for Shopify:**
   ```bash
   npm run shopify:deploy
   ```
   This runs three scripts:
   - `build-shopify.mjs`: Builds and renames files
   - `upload-to-shopify.mjs`: Uploads to Shopify theme
   - `create-section.mjs`: Updates Liquid section

### Validation

Before deployment, validate theme structure:
```bash
npm run shopify:validate
```

This checks:
- Required directories exist
- Required files are present
- JSON files are valid
- Theme configuration is correct

## Customization Guide

### Adding a New Section

1. **Create the section file:**
   ```bash
   touch sections/my-section.liquid
   ```

2. **Add Liquid markup and schema:**
   ```liquid
   <div class="my-section">
     <h2>{{ section.settings.title }}</h2>
     <p>{{ section.settings.content }}</p>
   </div>
   
   {% schema %}
   {
     "name": "My Custom Section",
     "settings": [
       {
         "type": "text",
         "id": "title",
         "label": "Section Title",
         "default": "Welcome"
       },
       {
         "type": "textarea",
         "id": "content",
         "label": "Content"
       }
     ],
     "presets": [
       {
         "name": "My Custom Section"
       }
     ]
   }
   {% endschema %}
   ```

3. **Use in a template:**
   ```liquid
   {% section 'my-section' %}
   ```

### Modifying Theme Settings

1. **Edit `config/settings_schema.json`**
2. **Add new settings:**
   ```json
   {
     "name": "Advanced Settings",
     "settings": [
       {
         "type": "checkbox",
         "id": "enable_feature",
         "label": "Enable Custom Feature",
         "default": false
       }
     ]
   }
   ```

3. **Access in templates:**
   ```liquid
   {% if settings.enable_feature %}
     <!-- Feature code -->
   {% endif %}
   ```

### Customizing the React Dashboard

1. **Edit React components** in `src/client/components/`
2. **Add new features** following React best practices
3. **Update TypeScript types** in `src/client/types/`
4. **Test locally** with `npm run dev`
5. **Build and deploy** with `npm run shopify:deploy`

### Adding Custom Styles

1. **For Liquid templates:**
   - Add CSS to a file in `assets/`
   - Include with: `{{ 'custom-styles.css' | asset_url | stylesheet_tag }}`

2. **For React components:**
   - Add styles in component files or `src/client/styles/`
   - Styles are bundled automatically during build

### Internationalization (i18n)

1. **Add translations to `locales/en.default.json`:**
   ```json
   {
     "general": {
       "welcome": "Welcome",
       "loading": "Loading..."
     }
   }
   ```

2. **Use in Liquid templates:**
   ```liquid
   {{ 'general.welcome' | t }}
   ```

3. **Add additional language files:**
   - `locales/fr.json` for French
   - `locales/es.json` for Spanish
   - etc.

## Liquid Best Practices

### Security

**Always use the `json` filter when passing data to JavaScript:**
```liquid
<!-- ‚úÖ CORRECT - Safe from XSS -->
<script>
  const config = {{ section.settings | json }};
</script>

<!-- ‚ùå WRONG - Vulnerable to XSS -->
<script>
  const config = {{ section.settings }};
</script>
```

### Performance

**Minimize liquid logic in loops:**
```liquid
<!-- ‚úÖ BETTER - Calculate once -->
{% assign discount_rate = 0.2 %}
{% for product in collection.products %}
  {% assign sale_price = product.price | times: discount_rate %}
{% endfor %}

<!-- ‚ùå SLOWER - Calculation in every iteration -->
{% for product in collection.products %}
  {% assign sale_price = product.price | times: 0.2 %}
{% endfor %}
```

### Readability

**Use comments for complex sections:**
```liquid
{% comment %}
  This section handles the product grid display
  with filtering and pagination support
{% endcomment %}
```

**Reference section locations:**
```liquid
{% comment %}
  Theme: TOrqued v3
  Template: templates/index.liquid
  Section: sections/hero-banner.liquid
{% endcomment %}
```

### Validation

**Check for variable existence:**
```liquid
{% if product %}
  {{ product.title }}
{% else %}
  <p>Product not found</p>
{% endif %}
```

**Use default values:**
```liquid
{{ section.settings.title | default: "Default Title" }}
```

## Asset Management

### Compiled Assets

React app assets are built into:
- `assets/torqued-dashboard.js` - JavaScript bundle
- `assets/torqued-dashboard.css` - Stylesheet bundle

### Static Assets

Place static files in `assets/`:
- Images: `logo.png`, `hero-image.jpg`
- Fonts: `custom-font.woff2`
- Custom scripts: `custom-script.js`

### Asset URLs

**In Liquid templates:**
```liquid
{{ 'filename.js' | asset_url | script_tag }}
{{ 'filename.css' | asset_url | stylesheet_tag }}
<img src="{{ 'image.jpg' | asset_url }}" alt="Description">
```

### Asset Optimization

- **Images**: Compress before uploading
- **JavaScript**: Minified during build process
- **CSS**: Minified and optimized during build
- **Fonts**: Use modern formats (WOFF2)

## Server-Side Features

### AI-Powered Personalization

**Location**: `src/server/ai/personalization.js`

The PersonalizationEngine provides AI-driven product recommendations and pricing optimization using OpenAI's GPT-4.

**Features:**
1. **Product Recommendations**: Generates personalized product suggestions based on user behavior and inventory
2. **Dynamic Pricing**: Optimizes pricing based on competitor prices and demand signals

**Configuration:**
```bash
# .env
OPENAI_API_KEY=sk-your_openai_key
ENABLE_AI_PERSONALIZATION=true
```

**Usage Example:**
```javascript
import { PersonalizationEngine } from './server/ai/personalization.js';

const engine = new PersonalizationEngine();
const recommendations = await engine.generateRecommendations(
  userId, 
  userBehavior, 
  inventory
);
```

**Response Format:**
```json
{
  "recommendations": [
    {
      "productId": "12345",
      "score": 0.95,
      "reason": "Frequently viewed similar items"
    }
  ]
}
```

### OAuth2 Authentication

**Location**: `src/server/auth/oauth2.js`

Provides secure OAuth2 authentication for user login and API access.

**Configuration:**
```bash
# .env
OAUTH_AUTH_URL=https://provider.com/oauth/authorize
OAUTH_TOKEN_URL=https://provider.com/oauth/token
OAUTH_CALLBACK=https://yourapp.com/auth/callback
CLIENT_ID=your-client-id
CLIENT_SECRET=your-client-secret
OAUTH_REFRESH_URL=https://provider.com/oauth/refresh
```

**Endpoints:**
- `GET /auth` - Initiates OAuth flow
- `GET /auth/callback` - Handles OAuth callback

### Role-Based Access Control (RBAC)

**Location**: `src/server/middleware/rbac.js`

Middleware for controlling access to features based on user roles.

**Usage:**
Add to your Express routes to restrict access based on user permissions.

### WebSocket Server

**Location**: `src/server/websockets/wsServer.js`

Real-time communication for affiliate events and live updates.

**Configuration:**
```bash
# .env
WS_PORT=8081
```

**Features:**
- Real-time affiliate event notifications
- Live dashboard updates
- Customer activity tracking

**Client Connection:**
```javascript
const ws = new WebSocket('ws://localhost:8081');
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('Received:', data);
};
```

### Secret Management

**Locations**: 
- `src/server/secrets.js` - Interface
- `src/server/secrets_aws.js` - AWS Secrets Manager
- `src/server/secrets_gcp.js` - GCP Secret Manager

Secure storage and retrieval of sensitive credentials using cloud providers.

**Configuration:**
```bash
# .env
SECRETS_PROVIDER=aws  # or 'gcp'
AWS_REGION=us-east-1
GCP_PROJECT=your-gcp-project-id
```

**Migration:**
```bash
# Migrate secrets to AWS
npm run migrate-secrets -- --provider=aws

# Migrate secrets to GCP
npm run migrate-secrets -- --provider=gcp
```

**Features:**
- Encrypted storage of API keys and secrets
- Automatic secret rotation support
- Multi-cloud support (AWS, GCP)

## Build Scripts Reference

### build-shopify.mjs

**Purpose**: Builds the React application specifically for Shopify deployment.

**What it does:**
1. Runs Vite build with `BUILD_TARGET=shopify` environment variable
2. Creates a single optimized bundle (no code splitting)
3. Renames output files to `torqued-dashboard.js` and `torqued-dashboard.css`
4. Prepares files for upload to Shopify theme

**Usage:**
```bash
npm run shopify:deploy  # Runs this automatically
```

**Build Target:**
- Sets `BUILD_TARGET='shopify'` to disable code splitting
- Ensures all dependencies are in single bundle
- Compatible with Shopify's asset loading system

### upload-to-shopify.mjs

**Purpose**: Uploads compiled assets to your Shopify theme.

**Requirements:**
- `SHOPIFY_STORE` - Your store domain
- `SHOPIFY_TOKEN` - Admin API access token
- `SHOPIFY_THEME_ID` - Target theme ID

**What it uploads:**
- `dist/assets/torqued-dashboard.js` ‚Üí `assets/torqued-dashboard.js`
- `dist/assets/torqued-dashboard.css` ‚Üí `assets/torqued-dashboard.css`

**Note**: Uses Shopify Admin API to update theme assets.

### create-section.mjs

**Purpose**: Creates or updates the Liquid section file for the dashboard.

**What it does:**
1. Generates `sections/torqued-interface.liquid` with proper schema
2. Includes configuration options in section schema
3. Sets up React mount point and asset loading

**Result**: A fully configured section ready to add to pages in Shopify theme editor.

### validate-theme.mjs

**Purpose**: Validates Shopify theme structure before deployment.

**What it checks:**
- ‚úì Required directories exist (config, layout, locales, sections, templates)
- ‚úì Required files present (settings_schema.json, theme.liquid, en.default.json)
- ‚úì JSON files are valid
- ‚úì Theme has theme_info in settings_schema.json
- ‚Ñπ Template and section counts

**Usage:**
```bash
npm run shopify:validate
```

**Exit codes:**
- `0` - Theme structure is valid
- `1` - Theme has issues that need fixing

### ai-optimize.mjs

**Purpose**: Uses AI to analyze and optimize bundle size.

**Requirements:**
```bash
OPENAI_API_KEY=sk-your_openai_key
```

**What it does:**
1. Analyzes bundle composition
2. Suggests optimization strategies
3. Identifies redundant dependencies
4. Recommends tree-shaking opportunities

**Usage:**
```bash
npm run ai:optimize
```

### deploy-edge.mjs

**Purpose**: Deploys application to Cloudflare Workers for edge computing.

**Requirements:**
```bash
CLOUDFLARE_API_TOKEN=your_cloudflare_token
CLOUDFLARE_ZONE_ID=your_zone_id
```

**Benefits:**
- Sub-50ms response times globally
- Reduced server load
- Built-in CDN and caching

**Usage:**
```bash
npm run deploy:edge
```

### migrate-secrets.js

**Purpose**: Migrates environment secrets to cloud secret managers.

**Supported Providers:**
- AWS Secrets Manager
- Google Cloud Secret Manager

**Usage:**
```bash
# AWS
npm run migrate-secrets -- --provider=aws

# GCP
npm run migrate-secrets -- --provider=gcp
```

**What it migrates:**
- API keys
- OAuth credentials
- Database credentials
- Third-party service tokens

### sync-branches.sh

**Purpose**: Synchronizes feature branches with master branch.

**Features:**
- Automatic sync on master push
- Conflict detection
- Dry-run mode for testing
- Skips copilot/* branches

**Usage:**
```bash
./scripts/sync-branches.sh
```

**Manual trigger:**
1. Go to GitHub Actions tab
2. Select "Sync All Branches with Master"
3. Click "Run workflow"
4. Optional: Enable dry-run mode

## Deployment

### Manual Deployment

```bash
# Full deployment process
npm run shopify:deploy
```

This executes:
1. `build-shopify.mjs` - Builds and renames assets
2. `upload-to-shopify.mjs` - Uploads to Shopify
3. `create-section.mjs` - Updates Liquid section

### CI/CD Deployment

GitHub Actions automatically deploys on push to `main`:
- Runs tests and linting
- Builds the application
- Deploys to Shopify theme
- Performs health checks

See `.github/workflows/ci.yml` for full pipeline.

### Deployment Checklist

Before deploying:
- [ ] Run `npm run lint` - No linting errors
- [ ] Run `npm test` - All tests pass
- [ ] Run `npm run build` - Build succeeds
- [ ] Run `npm run shopify:validate` - Theme validation passes
- [ ] Test locally with `npm run dev`
- [ ] Review changes in a development theme first
- [ ] Backup current theme (download from Shopify)

### Environment-Specific Deployment

**Development Theme:**
```bash
SHOPIFY_THEME_ID=dev_theme_id npm run shopify:deploy
```

**Staging Theme:**
```bash
SHOPIFY_THEME_ID=staging_theme_id npm run shopify:deploy
```

**Production Theme:**
```bash
npm run shopify:deploy  # Uses .env SHOPIFY_THEME_ID
```

## Troubleshooting

### Common Issues

#### Issue: Section not appearing in theme editor

**Solutions:**
1. Check that section file is in `sections/` directory
2. Verify `{% schema %}` block is present and valid JSON
3. Add `"presets"` to schema to make it addable
4. Clear theme cache in Shopify admin

#### Issue: React app not loading

**Solutions:**
1. Check browser console for errors
2. Verify `torqued-dashboard.js` and `.css` are uploaded
3. Check that `<div id="torqued-root">` exists in section
4. Ensure assets are loaded with correct tags
5. Try hard refresh (Ctrl+Shift+R)

#### Issue: Liquid syntax errors

**Solutions:**
1. Validate Liquid syntax at [Shopify Liquid Syntax](https://shopify.dev/docs/themes/liquid/reference)
2. Check for unclosed tags (`{% if %}` without `{% endif %}`)
3. Review Shopify theme check output
4. Use online Liquid validators

#### Issue: Build fails

**Solutions:**
1. Clear node_modules and reinstall: `rm -rf node_modules && npm install`
2. Clear build cache: `rm -rf dist/`
3. Check Node.js version: `node --version` (should be 18+)
4. Review error messages for specific issues
5. Check TypeScript compilation: `npx tsc --noEmit`

#### Issue: Upload to Shopify fails

**Solutions:**
1. Verify environment variables in `.env`
2. Check Shopify API credentials are valid
3. Ensure theme ID exists and is accessible
4. Verify API permissions include "Theme" scope
5. Check network connectivity

### Debug Mode

Enable detailed logging:
```bash
DEBUG=* npm run shopify:deploy
```

### Getting Help

If issues persist:
1. Check [Shopify Theme Documentation](https://shopify.dev/docs/themes)
2. Review [GitHub Issues](https://github.com/PublicPNWEK/TOrqued/issues)
3. Open a new issue with:
   - Description of the problem
   - Steps to reproduce
   - Error messages or logs
   - Environment details (OS, Node version, etc.)

## Undocumented Features & Areas Requiring Deeper Explanation

This section lists features and components that exist in the codebase but may require additional documentation or clarification.

### ‚ö†Ô∏è Advanced Features Requiring Setup

The following features are present in the codebase but require external service configuration:

#### 1. **Edge Caching (Cloudflare Workers)**
- **Status**: Implemented but needs Cloudflare account setup
- **Files**: `scripts/deploy-edge.mjs`
- **Required Config**: `CLOUDFLARE_API_TOKEN`, `CLOUDFLARE_ZONE_ID`
- **Benefits**: Sub-50ms global response times
- **Documentation Needed**: 
  - Cloudflare account setup guide
  - Worker deployment process
  - Edge caching strategies
  - Debugging edge deployments

#### 2. **AI Personalization (OpenAI)**
- **Status**: Implemented but requires OpenAI API key
- **Files**: `src/server/ai/personalization.js`
- **Required Config**: `OPENAI_API_KEY`
- **Features**: Product recommendations, dynamic pricing
- **Documentation Needed**:
  - OpenAI API setup and billing
  - Cost optimization strategies
  - Fallback handling when AI is unavailable
  - Fine-tuning recommendation algorithms
  - Privacy considerations for user data

#### 3. **Fraud Detection**
- **Status**: Referenced in settings but implementation not visible
- **Config**: `ENABLE_FRAUD_DETECTION=true`
- **Documentation Needed**:
  - Implementation details
  - ML model training and deployment
  - Integration points
  - False positive handling
  - Compliance requirements (PCI-DSS)

#### 4. **WebSocket Real-Time Updates**
- **Status**: Basic implementation present
- **Files**: `src/server/websockets/wsServer.js`
- **Required Config**: `WS_PORT`
- **Documentation Needed**:
  - Production deployment (scaling, load balancing)
  - SSL/TLS configuration for secure WebSockets
  - Message protocol specification
  - Client reconnection strategies
  - Rate limiting and abuse prevention

#### 5. **OAuth2 Integration**
- **Status**: Basic implementation present
- **Files**: `src/server/auth/oauth2.js`
- **Required Config**: Multiple OAuth environment variables
- **Documentation Needed**:
  - Supported OAuth providers
  - Token refresh mechanism
  - Session management
  - Security best practices
  - Multi-tenant authentication

#### 6. **Multi-Tenant Architecture**
- **Status**: Referenced in README but no implementation details
- **Config**: `TENANT_ISOLATION`, `DEFAULT_TENANT`, `TENANT_SCALING_ENABLED`
- **Documentation Needed**:
  - Database schema for tenant isolation
  - Tenant provisioning process
  - Data segregation strategies
  - White-labeling options
  - Billing per tenant

#### 7. **Bundle Optimization & Analysis**
- **Status**: Tools available but usage not well documented
- **Scripts**: `optimize-bundle.mjs`, `ai-optimize.mjs`
- **Commands**: `npm run analyze:bundle`, `npm run ai:optimize`
- **Documentation Needed**:
  - Interpreting bundle analysis results
  - Common optimization strategies
  - Trade-offs (size vs. features)
  - Progressive loading techniques

### üîç Partially Documented Components

#### React Components
The following React components exist but lack detailed documentation:

1. **ComparisonMode.tsx**
   - Purpose: Unclear from filename
   - Usage: Not documented
   - Props: Unknown

2. **OnboardingTour.tsx**
   - Purpose: User onboarding flow
   - Library: react-joyride
   - Customization: Not documented

3. **Skeleton.tsx**
   - Purpose: Loading state placeholders
   - Implementation: Not shown in docs

4. **VirtualizedTable.tsx**
   - Purpose: Performance-optimized large tables
   - Library: react-window
   - Configuration: Not documented

**Recommendation**: Add a React Components reference guide with:
- Component purposes and use cases
- Props and TypeScript interfaces
- Usage examples
- Customization options

#### State Management

- **React Query** (`queryClient.tsx`): Configured but caching strategies not documented
- **Zustand** (`store.ts`): State structure and actions not documented
- **Best Practices**: When to use local vs global state

#### Build Configuration

- **Vite Config** (`vite.config.ts`): 
  - Code splitting strategy explained
  - But optimization options not fully documented
  - Plugin configuration could be clearer

- **TypeScript Config** (`tsconfig.json`):
  - Compiler options not explained
  - Path aliases (if any) not documented

### üìã Missing Documentation

#### 1. Testing
- **Status**: Test dependencies installed but no test files visible
- **Tools**: Vitest, Playwright
- **Needed**:
  - Writing unit tests
  - E2E testing guide
  - CI/CD test integration
  - Code coverage goals

#### 2. Monitoring & Analytics
- **Referenced**: Analytics API key, Sentry, Datadog in .env.example
- **Missing**:
  - Integration guides for each service
  - Dashboard setup
  - Alert configuration
  - Performance metrics to track

#### 3. Security
- **Tools**: Security scan script exists
- **Missing**:
  - Security audit checklist
  - Vulnerability response process
  - Dependency update strategy
  - Secure coding guidelines

#### 4. Performance
- **Benchmarks**: Mentioned in README
- **Missing**:
  - How to run performance tests
  - Interpreting Lighthouse scores
  - Optimization checklist
  - Real-world performance metrics

#### 5. Locales & Internationalization
- **Implementation**: `locales/en.default.json` exists
- **Missing**:
  - Adding new languages
  - Translation workflow
  - RTL language support
  - Locale-specific formatting

#### 6. Environment-Specific Configuration
- **Development vs Production**: Not clearly explained
- **Missing**:
  - Environment variable precedence
  - Multiple environment setup (.env.dev, .env.prod)
  - Feature flags
  - Debug mode configuration

### üéØ Recommended Workflow Enhancements

The current workflow is documented, but could be enhanced with:

#### For Theme Customization:
1. **Design System**: Color palette, typography, spacing guidelines
2. **Component Library**: Reusable UI components
3. **Style Guide**: CSS/SCSS organization and naming conventions
4. **Responsive Design**: Breakpoints and mobile-first approach

#### For Feature Development:
1. **Feature Branching**: Git workflow best practices
2. **Code Review Process**: What to look for, approval requirements
3. **Commit Message Conventions**: Semantic commit format
4. **Pull Request Templates**: Standardized PR descriptions

#### For Deployment:
1. **Staging Environment**: Testing before production
2. **Rollback Procedures**: How to revert failed deployments
3. **Health Checks**: Post-deployment verification
4. **Blue-Green Deployment**: Zero-downtime deployments

### üîß Customization Tips by Use Case

#### E-commerce Store Owner (Non-Technical)
- **What you can do**:
  - Change colors and fonts in theme settings
  - Add/remove sections in theme editor
  - Configure LeadDyno for affiliate tracking
  - Enable/disable advanced features via checkboxes
- **What requires developer**:
  - Custom product recommendation logic
  - Payment gateway integrations
  - Custom checkout flows

#### Developer (Adding Features)
- **Start here**:
  1. Understand the two-layer architecture
  2. React changes: `src/client/`
  3. Liquid changes: `sections/`, `templates/`
  4. Test locally with `npm run dev`
  5. Deploy with `npm run shopify:deploy`
- **Common tasks**:
  - Adding new React component: Create in `src/client/components/`
  - Adding new Shopify section: Create `.liquid` file in `sections/`
  - Modifying build: Update `vite.config.ts`

#### Agency/Developer (Multi-Client Deployment)
- **Considerations**:
  - Use separate `.env` files per client
  - Theme ID management for multiple stores
  - White-labeling options (multi-tenant features)
  - Automated deployment per client
  - Secret management with cloud providers

#### Enterprise (Advanced Integration)
- **Integration points**:
  - OAuth2 for SSO integration
  - WebSocket for real-time updates
  - AI personalization API
  - Cloud secrets for secure credential storage
  - Edge deployment for global performance
- **Scaling considerations**:
  - Load balancing WebSocket connections
  - Rate limiting API calls
  - Caching strategies
  - Database optimization

### üìö Additional Context

#### Why This Architecture?

**Hybrid Approach Benefits:**
- **Shopify Liquid**: SEO-friendly, server-rendered pages
- **React Dashboard**: Rich, interactive user experience
- **Best of Both**: Fast initial load + dynamic interactivity

**Trade-offs:**
- More complex than pure Liquid theme
- Requires build step
- Two different templating paradigms

**When to Use This Theme:**
- Need advanced dashboard/analytics
- Affiliate program with complex tracking
- Customer portal with real-time updates
- Want modern React development experience

#### Development Philosophy

This theme prioritizes:
1. **Performance**: Optimized builds, code splitting, edge caching
2. **Security**: OAuth2, secret management, fraud detection
3. **Scalability**: WebSocket, multi-tenant, cloud-native
4. **Developer Experience**: TypeScript, hot reload, modern tooling

### üöÄ Future Documentation Needs

As the project evolves, consider documenting:
1. **GraphQL Integration**: If/when implemented
2. **Micro-frontend Architecture**: If adopting module federation
3. **Blockchain Affiliate Tracking**: If/when implemented
4. **AR/VR Shopping**: If/when added
5. **Progressive Web App**: Service worker implementation
6. **Native Mobile Apps**: If React Native integration added

## Additional Resources

### Official Documentation
- [Shopify Theme Development](https://shopify.dev/docs/themes)
- [Liquid Reference](https://shopify.dev/docs/themes/liquid/reference)
- [Theme Architecture](https://shopify.dev/docs/themes/architecture)
- [Shopify CLI](https://shopify.dev/docs/themes/tools/cli)

### TOrqued Documentation
- [README.md](../README.md) - Getting started guide
- [CONTRIBUTING.md](../CONTRIBUTING.md) - Contribution guidelines
- [THEME_IMPORT.md](../THEME_IMPORT.md) - Theme import guide
- [COMPETITIVE_ADVANTAGES.md](../COMPETITIVE_ADVANTAGES.md) - Advanced features

### Tools
- [Shopify Theme Kit](https://shopify.github.io/themekit/)
- [Shopify CLI](https://shopify.dev/docs/themes/tools/cli)
- [Liquid Syntax Highlighter](https://marketplace.visualstudio.com/items?itemName=Shopify.theme-check-vscode) (VS Code)

---

**Need Help?** If you have questions about the theme structure or customization, please open an issue or refer to the [Contributing Guide](../CONTRIBUTING.md) for assistance.
